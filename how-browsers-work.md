# 浏览器工作原理
## 01. 为什么仅仅打开了一个页面，浏览器就启动了四个进程?

### 进程 VS 线程
- 很多人容易把进程和线程的概念混淆，实际上线程可以说是进程的子集，线程之间可以并行运行，同时也能共享进程中的数据，值得注意的是：进程中的任意一个线程执行出错都会导致整个进程的崩溃
- 进程是一个程序的运行实例，当一个程序启动的时候，系统会为这个程序创建一块内存，用来存放代码、数据和一个执行任务的主线程，这样的一个运行环境称作为进程
- 当一个进程关闭之后，系统会回收进程所占用的内存，即使其中任意线程存在操作不当而导致的内存泄漏，当进程退出时，这些内存也会被正确回收
- 进程之间相互独立，每个进程只能访问自己的数据，正因为进程之间互不影响，所以当一个进程挂起或崩溃时，是不会影响到其他进程的，注：使用IPC机制可以实现进程之间的通信

### Chrome多进程架构
一个浏览器主进程、一个GPU进程、一个网络进程、多个渲染进程、多个插件进程
- 浏览器主进程：负责界面显示、用户交互、子进程协调管理，同时提供存储功能
- GPU进程：初衷是为了实现CSS 3D效果，现在页面UI都采用GPU绘制
- 网络进程：负责页面的网络资源加载，之前作为一个模块运行在浏览器进程里面，现在成为一个单独的进程
- 插件进程：负责插件的运行，因插件易崩溃，所有需要通过插件来隔离，以保证插件崩溃不会对浏览器页面造成影响
- 渲染进程：核心任务是将HTML、CSS、JS转换为用户可以与之交互的网页，Blink排版引擎和V8引擎都运行在该进程中，Chrome会为每个tab标签创建一个渲染进程，出于安全考虑， 渲染进程都是运行在沙箱模式下
![Chrome多进程架构图](https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png)


**process-per-site-instance策略：同一站点的tab标签页面共享一个渲染进程，所以，这种情况下，一个页面崩溃了就会导致统一站点的页面同时崩溃，因为它们使用了一个渲染进程**

> 优点：稳定、流畅、安全
> 缺点：更高的资源占用、更复杂的体系架构

### Chrome的未来：面向服务的架构SOA
为了解决优化多进程架构下的资源占用和复杂的体系架构问题，Chrome团队使用“面向服务的架构”的思想设计了新的架构，也就是说Chrome整体架构会朝向现代操作系统所采用的“面向服务的架构”的方向发展，原来的各种模块会被重构成独立的服务，每个服务都可以在独立的进程中运行，访问服务必须使用定义好的API，通过IPC来通信，从而构建一个更**内聚、松耦合、易于维护和扩展**的系统，更好实现Chrome简单、稳定、高速、安全的目标

![面向服务架构图](https://static001.geekbang.org/resource/image/32/2a/329658fe821252db47b0964037a1de2a.png)


### 灵活的弹性架构
Chrome提供了优雅降级功能， 即在资源受限的设备上，Chrome会将很多进程整合到一个主进程中，从而节省内存占用\
![在资源不足的设备上，将服务整合到浏览器进程中](https://static001.geekbang.org/resource/image/a9/76/a9ba86d7b03263fa3997d3733d958176.png)